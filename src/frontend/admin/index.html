<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Floor Layout</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .room:hover {
      transform: scale(1.05);
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      padding-top: 60px;
    }

    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      /* Centers the modal vertically */
      padding: 15px;
      /* Reduce padding */
      border: 1px solid #888;
      width: 50%;
      /* Adjust the width (default is 80%) */
      border-radius: 10px;
      /* Rounded corners */
      max-width: 400px;
      /* Optional: Set a maximum width */
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    button {
      padding: 10px 20px;
      background-color: #6c34a3;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #563080;
    }

    #scheduleContent {
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      background-color: #f9f9f9;
    }
  </style>
</head>

<body>
  <header>
    <div class="floor-buttons">
      <a href="floor2.html"><button>‡∏ä‡∏±‡πâ‡∏ô 2</button></a>
      <a href="floor3.html"><button>‡∏ä‡∏±‡πâ‡∏ô 3</button></a>
      <button>‡∏ä‡∏±‡πâ‡∏ô 4</button>
    </div>
    <div class="report-buttons">
      <a href="user_requests_InTime.html"><button>‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á</button></a>
      <a href="request_crash_equipments.html"><button>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ä‡∏≥‡∏£‡∏∏‡∏î</button></a>
    </div>
    <div class="logout-button">
      <button onclick="logout()" class="btn btn-warning">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button></div>
    </div>
  </header>
  <main>
    <div class="layout">
      <div class="room vertical" id="SC2-411" onclick="manageRoom('SC2-411')">SC2-411</div>
      <div class="room large" id="SC2-412">SC2-412</div>
      <div class="room small" id="sc2-413">sc2-413</div>
      <div class="room large1" id="sc2-414" onclick="manageRoom('sc2-414')">sc2-414</div>
      <div class="room vertical1" id="sc2-415" onclick="manageRoom('sc2-415')">SC2-415</div>
      <div class="room small1">sc2-416</div>
      <div class="room small2">sc2-416</div>
      <div class="room vertical2">SC2-417</div>
      <div class="room small3">sc2-418</div>
      <div class="room small4">sc2-418</div>
      <div class="room vertical1Down">sc2-410</div>
      <div class="room vertical1Down">‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏≤ ‡∏´‡∏ç‡∏¥‡∏á</div>
      <div class="room vertical1Down">‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏≤ ‡∏ä‡∏≤‡∏¢</div>
      <div class="room smallDown">sc2-409</div>
      <div class="room largeDown1">sc2-408</div>
      <div class="room largeDown2" id="sc2-407" onclick="manageRoom('sc2-407')">sc2-407</div>
    </div>

    <!-- Modal (Popup) -->
    <div id="roomModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="roomDetailTitle">Room Details</h2>
        <button id="roomDetailsButton">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á</button>
        <button id="scheduleButton">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á</button>
        <div>
          <label for="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á :</label>
          <select id="status">
            <option value="available">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
            <option value="not-available">‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
          </select>
        </div>
        <button id="saveStatus">Save Status</button>
      </div>
    </div>
    </div>
    <script src="../script/config.js"></script>
    <script>
      // Modal and Room Elements
      const modal = document.getElementById("roomModal");
      const closeModal = document.querySelector(".close");
      const saveStatusButton = document.getElementById("saveStatus");
      const statusSelect = document.getElementById("status");
      const roomDetailTitle = document.getElementById("roomDetailTitle");
      const roomDetailsButton = document.getElementById("roomDetailsButton");

      let currentRoomElement = null; // Track the current room being edited

      // Function to manage the room details
      function manageRoom(roomId) {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤ roomId ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        console.log("roomId ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å:", roomId);

        // ‡∏î‡∏∂‡∏á element ‡∏ó‡∏µ‡πà‡∏°‡∏µ id ‡πÄ‡∏õ‡πá‡∏ô roomId
        currentRoomElement = document.getElementById(roomId);

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á roomId ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å
        const roomName = currentRoomElement.innerText;

        // ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
        roomDetailTitle.innerText = `‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á: ${roomName}`;

        // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô loadSchedule ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
        // loadSchedule(roomId);

        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á
        const currentStatus = currentRoomElement.classList.contains('available') ? 'available' : 'not-available';
        statusSelect.value = currentStatus === 'available' ? 'available' : 'not-available';

        // ‡πÅ‡∏™‡∏î‡∏á modal
        modal.style.display = "block";

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î action ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° scheduleButton ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á
        const scheduleButton = document.getElementById("scheduleButton");

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î URL ‡∏Ç‡∏≠‡∏á schedule ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ
        if (roomId === 'sc2-414') {
          scheduleButton.onclick = () => window.location.href = "Schedule414.html";
        }
        if (roomId === 'sc2-407') {
          scheduleButton.onclick = () => window.location.href = "Schedule407.html";
        }
        if (roomId === 'SC2-411') {
          scheduleButton.onclick = () => window.location.href = "Schedule411.html";
        }
        if (roomId === 'sc2-415') {
          scheduleButton.onclick = () => window.location.href = "Schedule415.html";
        }

        const roomPage = "Room_Detail.html";

        // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ roomId ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà
        const numericId = roomId.toLowerCase().replace("sc2-", "").replace("sc2-", "");

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const roomIdsForDetails = ['407', '411', '414', '415'];

        document.getElementById("roomDetailsButton").onclick = function () {
          // ‡∏ñ‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ roomId
          if (roomIdsForDetails.includes(numericId)) {
            window.location.href = `${roomPage}?room=${numericId}`;
          } else {
            alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ");
          }
        };
      }

      // Save the room status and update the room element
      saveStatusButton.onclick = async function () {
        const selectedStatus = statusSelect.value;

        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô class ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤ UI
        if (selectedStatus === "available") {
          currentRoomElement.classList.add("available");
          currentRoomElement.classList.remove("not-available", "closed");
        } else if (selectedStatus === "not-available") {
          currentRoomElement.classList.add("not-available");
          currentRoomElement.classList.remove("available", "closed");
        } else if (selectedStatus === "closed") {
          currentRoomElement.classList.add("closed");
          currentRoomElement.classList.remove("available", "not-available");
        }

        // üü¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï room_status
        const roomName = currentRoomElement.innerText.split(" ")[0]; // ‡πÄ‡∏ä‡πà‡∏ô SC2-307
        const statusText =
          selectedStatus === "available"
            ? "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
            : "‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";

        try {
          const res = await fetch(`${CONFIG.API_URL}/updateRoomStatus`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              room_name: roomName,
              room_status: statusText,
            }),
          });

          const result = await res.json();
          if (res.ok) {
            alert("‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          } else {
            alert("‚ùå ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + result.message);
          }
        } catch (err) {
          console.error("‚ùå Error:", err);
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
        }

        modal.style.display = "none";
      };


      // Close the modal
      closeModal.onclick = function () {
        modal.style.display = "none";
      };

      // Close the modal if clicked outside of it
      window.onclick = function (event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      };

      // Load room status from localStorage when the page reloads
      window.onload = async function () {
        try {
          const response = await fetch(`${CONFIG.API_URL}/getRoomStatuses`);
          const roomStatuses = await response.json();

          const rooms = document.querySelectorAll(".room");

          rooms.forEach(room => {
            const roomName = room.id.toUpperCase();
            const statusData = roomStatuses.find(r => r.room_name.toUpperCase() === roomName);

            if (statusData) {
              room.classList.remove("available", "not-available", "closed");

              if (statusData.room_status === "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô") {
                room.classList.add("available");
              } else if (statusData.room_status === "‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô") {
                room.classList.add("not-available");
              } else if (statusData.room_status === "‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á") {
                room.classList.add("closed");
                if (!room.innerText.includes("‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á")) {
                  room.innerText += " (‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á)";
                }
              }
            }
          });
        } catch (err) {
          console.error("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ:", err);
        }
      };



      // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ñ‡∏∂‡∏á search input ‡πÅ‡∏•‡∏∞ reports container
      const searchInput = document.getElementById("searchInput");
      const reportsContainer = document.querySelector(".reports");
      const reportItems = document.querySelectorAll(".report");

      // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      searchInput.addEventListener("input", function () {
        const query = searchInput.value.toLowerCase();

        reportItems.forEach((report) => {
          const reportText = report.textContent.toLowerCase();

          // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
          if (reportText.includes(query)) {
            report.style.display = "block";
          } else {
            report.style.display = "none";
          }
        });
      });
    </script>
    <script>
      const categories = document.querySelectorAll(".categories li");
      const reports = document.querySelectorAll(".reports .report");

      // Add click event listener to each category item
      categories.forEach((category) => {
        category.addEventListener("click", () => {
          // Toggle active class on the category
          category.classList.toggle("active");

          // Get the category ID from data-category attribute
          const categoryId = category.getAttribute("data-category");

          // Show or hide reports based on the clicked category
          reports.forEach((report) => {
            if (report.getAttribute("data-category") === categoryId) {
              // Toggle visibility of the selected category reports
              if (category.classList.contains("active")) {
                report.style.display = "block"; // Show the report
              } else {
                report.style.display = "none"; // Hide the report
              }
            } else {
              // Always hide reports that don't match the selected category
              report.style.display = "none";
            }
          });
        });
      });
    </script>
    <script src="logout.js"></script>
    <!-- <script src="CheckStatus.js"></script> -->
     <script src="../script/auth.js"></script>
</body>

</html>